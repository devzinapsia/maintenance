<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Template del formulario de solicitud de mantenimiento -->
    <template id="maintenance_request_form_template" name="Maintenance Request Form">
        <t t-call="website.layout">
            <div id="wrap" class="oe_structure oe_empty">
                <section class="pt-5 pb-5">
                    <div class="container">
                        <div class="row">
                            <div class="col-lg-8 offset-lg-2">
                                <h1 class="text-center mb-4">Solicitud de Mantenimiento</h1>
                                
                                <!-- Mensajes de error -->
                                <t t-if="error_message">
                                    <div class="alert alert-danger" role="alert">
                                        <t t-foreach="error_message" t-as="err">
                                            <p class="mb-0"><t t-esc="err"/></p>
                                        </t>
                                    </div>
                                </t>
                                
                                <form action="/maintenance/request/submit" method="post" enctype="multipart/form-data">
                                    <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                    
                                    <!-- Campo: Responsable (Empleado) -->
                                    <div class="mb-3">
                                        <label for="employee_id" class="form-label">
                                            Responsable (Solicitado por) <span class="text-danger">*</span>
                                        </label>
                                        <select name="employee_id" 
                                                id="employee_id" 
                                                class="form-select" 
                                                required="required"
                                                t-att-class="'is-invalid' if error.get('employee_id') else ''">
                                            <option value="">-- Seleccione un empleado --</option>
                                            <t t-foreach="employees" t-as="employee">
                                                <option t-att-value="employee.id" 
                                                        t-att-selected="'selected' if str(employee.id) == str(employee_id) else None">
                                                    <t t-esc="employee.name"/>
                                                </option>
                                            </t>
                                        </select>
                                        <t t-if="error.get('employee_id')">
                                            <div class="invalid-feedback d-block">
                                                Por favor seleccione un responsable.
                                            </div>
                                        </t>
                                        <div class="form-text">
                                            Seleccione el empleado que solicita el mantenimiento.
                                        </div>
                                    </div>
                                    
                                    <!-- Campo: Equipo -->
                                    <div class="mb-3">
                                        <label for="equipment_id" class="form-label">
                                            Equipo Averiado <span class="text-danger">*</span>
                                        </label>
                                        <select name="equipment_id" 
                                                id="equipment_id" 
                                                class="form-select" 
                                                required="required"
                                                t-att-class="'is-invalid' if error.get('equipment_id') else ''">
                                            <option value="">-- Seleccione un equipo --</option>
                                            <t t-foreach="equipments" t-as="equipment">
                                                <option t-att-value="equipment.id"
                                                        t-att-selected="'selected' if str(equipment.id) == str(equipment_id) else None">
                                                    <t t-esc="equipment.name"/>
                                                    <t t-if="equipment.category_id"> - <t t-esc="equipment.category_id.name"/></t>
                                                </option>
                                            </t>
                                        </select>
                                        <t t-if="error.get('equipment_id')">
                                            <div class="invalid-feedback d-block">
                                                Por favor seleccione un equipo.
                                            </div>
                                        </t>
                                        <div class="form-text">
                                            Seleccione el equipo que requiere mantenimiento.
                                        </div>
                                    </div>
                                    
                                    <!-- Campo: Descripción -->
                                    <div class="mb-3">
                                        <label for="description" class="form-label">
                                            Descripción del Problema <span class="text-danger">*</span>
                                        </label>
                                        <textarea name="description" 
                                                  id="description" 
                                                  class="form-control" 
                                                  rows="6" 
                                                  required="required"
                                                  placeholder="Describa detalladamente el problema detectado..."
                                                  t-att-class="'is-invalid' if error.get('description') else ''"><t t-if="description" t-esc="description"/></textarea>
                                        <t t-if="error.get('description')">
                                            <div class="invalid-feedback d-block">
                                                <t t-if="error.get('description') == 'missing'">
                                                    Por favor ingrese una descripción.
                                                </t>
                                                <t t-if="error.get('description') == 'too_short'">
                                                    La descripción debe tener al menos 10 caracteres.
                                                </t>
                                            </div>
                                        </t>
                                        <div class="form-text">
                                            Proporcione una descripción detallada del problema (mínimo 10 caracteres).
                                        </div>
                                    </div>
                                    
                                    <!-- Botón de envío -->
                                    <div class="mb-3 text-center">
                                        <button type="submit" class="btn btn-primary btn-lg">
                                            <i class="fa fa-paper-plane me-2"></i>
                                            Enviar Solicitud
                                        </button>
                                    </div>
                                    
                                    <div class="text-center text-muted">
                                        <small>* Campos obligatorios</small>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </t>
    </template>

    <!-- Template de página de agradecimiento -->
    <template id="maintenance_request_thanks_template" name="Maintenance Request Thanks">
        <t t-call="website.layout">
            <div id="wrap" class="oe_structure oe_empty">
                <section class="pt-5 pb-5">
                    <div class="container">
                        <div class="row">
                            <div class="col-lg-8 offset-lg-2 text-center">
                                <div class="alert alert-success p-5" role="alert">
                                    <i class="fa fa-check-circle fa-4x mb-4 text-success"></i>
                                    <h1 class="mb-4">¡Solicitud Enviada Satisfactoriamente!</h1>
                                    <p class="lead mb-4">
                                        Su solicitud de mantenimiento ha sido registrada exitosamente.
                                    </p>
                                    <p class="mb-4">
                                        Nuestro equipo técnico revisará su solicitud y se pondrá en contacto con usted a la brevedad para coordinar el mantenimiento.
                                    </p>
                                    <t t-if="request_id">
                                        <p class="text-muted">
                                            <strong>Número de solicitud:</strong> #<t t-esc="request_id"/>
                                        </p>
                                    </t>
                                    <hr class="my-4"/>
                                    <div class="mt-4">
                                        <a href="/maintenance/request" class="btn btn-primary me-2">
                                            <i class="fa fa-plus me-2"></i>
                                            Nueva Solicitud
                                        </a>
                                        <a href="/" class="btn btn-secondary">
                                            <i class="fa fa-home me-2"></i>
                                            Volver al Inicio
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </t>
    </template>

    <!-- Menú del sitio web -->
    <record id="menu_maintenance_request" model="website.menu">
        <field name="name">Solicitud de Mantenimiento</field>
        <field name="url">/maintenance/request</field>
        <field name="parent_id" ref="website.main_menu"/>
        <field name="sequence">80</field>
    </record>

</odoo>